<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–¥–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é</title>
    <link rel="stylesheet" href="../static/styles/add_operation_styles.css">
</head>
<body>

<header>
    <div class="nav-container">
        <a href="main_admin.html"><img src="../static/icons/home.png" alt="–ù–∞ –≥–æ–ª–æ–≤–Ω—É" class="tab-link-icon"></a>
        <a href="main_admin.html" class="tab-link">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>
    <div class="account-info">
        <img src="../static/icons/account.png" alt="–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä">
    </div>
</header>

<main class="operation-container">
    <div class="form-section">
        <h3>–ë–ª–æ–∫ 1: –î–æ–¥–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é</h3>
        <div class="select-block">
            <label for="operationName">–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –æ–ø–µ—Ä–∞—Ü—ñ—ó:</label>
            <input type="text" id="operationName" placeholder="–ù–∞–∑–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó">
        </div>


        <label for="locationSelect">–û–±–µ—Ä—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é:</label>
        <select id="locationSelect">
            <!-- –ó–∞–ø–æ–≤–Ω–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
        </select>

        <div class="select-block">
            <label>–í–∫–∞–∂—ñ—Ç—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏:</label>
            <input type="text" placeholder="–ü–æ—à—É–∫ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤..." oninput="filterCheckboxes('toolsCheckboxes', this.value)">
            <div id="toolsCheckboxes" class="checkbox-group"></div>
        </div>

        <div class="select-block">
            <label>–í–∫–∞–∂—ñ—Ç—å –º–∞—Ç–µ—Ä—ñ–∞–ª–∏:</label>
            <input type="text" placeholder="–ü–æ—à—É–∫ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤..." oninput="filterCheckboxes('materialsCheckboxes', this.value)">
            <div id="materialsCheckboxes" class="checkbox-group"></div>
        </div>

        <div class="select-block">
            <label>–í–∫–∞–∂—ñ—Ç—å –∑–∞–ª–µ–∂–Ω—ñ –±–ª–æ–∫–∏:</label>
            <input type="text" placeholder="–ü–æ—à—É–∫ –±–ª–æ–∫—ñ–≤..." oninput="filterCheckboxes('dependencyCheckboxes', this.value)">
            <div id="dependencyCheckboxes" class="checkbox-group"></div>
        </div>

    </div>

    <div class="instruction-section">
        <h4>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</h4>

        <div class="upload-group">
            <button onclick="uploadFile('text/pdf', 'pdfList')" class="upload-btn">üìé –ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é</button>
            <ul id="pdfList" class="file-list"></ul>
        </div>

        <div class="upload-group">
            <button onclick="uploadFile('video/mp4', 'videoList')" class="upload-btn">üìé –ü—Ä–∏–∫—Ä—ñ–ø–∏—Ç–∏ –≤—ñ–¥–µ–æ-—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é</button>
            <ul id="videoList" class="file-list"></ul>
        </div>

        <div class="upload-group">
            <button onclick="uploadFile('image/png', 'imageList', true)" class="upload-btn">üìé –ù–∞–¥–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥–∏ –≥–æ—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫—É</button>
            <ul id="imageList" class="file-list"></ul>
        </div>

        <input type="file" id="fileInput" style="display:none" multiple>
    </div>

</main>


<div class="btn-container">
    <button class="confirm-btn" onclick="submitOperation()">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò</button>
</div>

<script>
    const locations = ["–¶–µ—Ö 1", "–¶–µ—Ö 2", "–¶–µ—Ö 3"];
    const tools = ["–ú–æ–ª–æ—Ç–æ–∫", "–î—Ä–∏–ª—å", "–í–∏–∫—Ä—É—Ç–∫–∞"];
    const materials = ["–î–µ—Ä–µ–≤–æ", "–ú–µ—Ç–∞–ª", "–ü–ª–∞—Å—Ç–∏–∫"];
    const dependencies = ["–ë–ª–æ–∫ –ê", "–ë–ª–æ–∫ –ë", "–ë–ª–æ–∫ –í"];

    window.onload = () => {
        populateSelect("locationSelect", locations);
        populateCheckboxes("toolsCheckboxes", tools);
        populateCheckboxes("materialsCheckboxes", materials);
        populateCheckboxes("dependencyCheckboxes", dependencies); // –î–æ–¥–∞–Ω–æ!
    };



    function populateSelect(id, items) {
        const select = document.getElementById(id);
        items.forEach(item => {
            const option = document.createElement("option");
            option.value = item;
            option.textContent = item;
            select.appendChild(option);
        });
    }

    function populateCheckboxes(id, items) {
        const container = document.getElementById(id);
        container.innerHTML = ""; // –æ—á–∏—Å—Ç–∏—Ç–∏, —è–∫—â–æ —Ç—Ä–µ–±–∞ –ø–µ—Ä–µ–∑–∞–ø–æ–≤–Ω–∏—Ç–∏
        items.forEach(item => {
            const label = document.createElement("label");
            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.value = item;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(" " + item));
            container.appendChild(label);
        });
    }

    function filterCheckboxes(containerId, query) {
        const container = document.getElementById(containerId);
        const checkboxes = container.querySelectorAll("label");
        const lowerQuery = query.toLowerCase();

        checkboxes.forEach(label => {
            const text = label.textContent.toLowerCase();
            label.style.display = text.includes(lowerQuery) ? "block" : "none";
        });
    }




    function uploadFile(acceptType, listId, multiple = false) {
        const input = document.getElementById("fileInput");
        input.accept = acceptType;
        input.multiple = multiple;

        input.onchange = () => {
            const list = document.getElementById(listId);
            [...input.files].forEach(file => {
                const listItem = document.createElement("li");
                const link = document.createElement("a");
                link.href = URL.createObjectURL(file);
                link.textContent = file.name;
                link.target = "_blank";
                listItem.appendChild(link);
                list.appendChild(listItem);
            });
            input.value = ""; // –æ—á–∏—Å—Ç–∏—Ç–∏ input, —â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ –≤–∏–±—Ä–∞—Ç–∏ —Ç—ñ –∂ —Ñ–∞–π–ª–∏ —â–µ —Ä–∞–∑
        };

        input.click();
    }


    function getCheckedValues(containerId) {
        const checkboxes = document.querySelectorAll(`#${containerId} input[type="checkbox"]`);
        return Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
    }

    function submitOperation() {
        const location = document.getElementById("locationSelect").value;
        const tools = getCheckedValues("toolsCheckboxes");
        const materials = getCheckedValues("materialsCheckboxes");
        const dependencies = getCheckedValues("dependencyCheckboxes");
        const name = document.getElementById("operationName").value.trim();


        const operation = {
            name,
            location,
            tools,
            materials,
            dependencies
        };


        sessionStorage.setItem("newOperation", JSON.stringify(operation));
        window.location.href = "add_product.html"; // –∞–±–æ history.back()
    }
</script>


</body>
</html>
